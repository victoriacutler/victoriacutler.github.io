{
  "hash": "403f96df1723480523b17d6675a02409",
  "result": {
    "markdown": "---\ntitle: \"Correlation vs Causation: Air Quality and Housing Prices\"\ndescription: \"Teasing out causation from correlation using difference-in-differences control group analysis.\"\nauthor:\n  - name: Victoria Cutler\n    url: https://victoriacutler.github.io # can also add orchid id under here\n    affiliation: Master of Environmental Data Science at The Bren School (UCSB) \n    affiliation-url: https://ucsb-meds.github.io\ndate: 2023-07-27\ncategories: [R, STATISTICS, LINEAR REGRESSION, CAUSATION, DIFFERENCE IN DIFFERENCES, CONTROL GROUPS, EQUITY]\ncitation:\n  url: https://victoriacutler.github.io/posts/correlation-vs-causation/\nbibliography: references.bib\nformat:\n  html:\n    code-fold: false\n    code-summary: \"code dropdown\"\nimage: \"correlation-vs-causation_labels.jpeg\"\ndraft: false # \"true\" will mean this is a draft post so it wont show up on my site\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n## How Can We Differentiate Between Correlation vs Causation?\n\nCorrelation can easily be confused with causation. Sometimes it's not so\nobvious whether X causes Y, or if X and Y are just correlated and simply\ntied together by a different actor, Z.\n\nFor example: consider that people often get ice cream on days that they\nalso end up getting sunburnt. Could this mean that ice cream may cause\nskin to burn? **Probably not.** This is because we know, intuitively,\nthat this is not the case. We also know, logically, that people may get\nice cream more on warm sunny days, and these warm sunny days cause the\nsunburn, not the ice cream. However, other problems are more nuanced an\ncomplex, and the answer may not be so obvious. How do we discern\ncausation from correlation, then?\n\n**The TLDR: we can use control groups!** Here, I use\ndifference-in-differences control group analysis to determine whether or\nnot increased proximity to an incinerator (a proxy for increased\nproximity to higher levels of air pollution) causes a decrease in\naverage housing values. A key assumption we need validated in order to\nperform this analysis is called the parallel trends assumption.\n\nFor this parallel trends assumption to hold water, we need to be fairly\ncertain that if we had withheld treatment (i.e. if a nearby incinerator\nwere never installed) the price of houses in the 'treated' group (i.e.\nhouses that actually did end up close to an incinerator) would have\nfollowed the same pricing trend as the 'control' group (i.e. houses that\nactually did *not* end up close to an incinerator). By controlling for\nother time invariant variables such as number of rooms, house size, and\nother attributes, I consider this assumption and analysis valid.\n\n## The Code\n\n#### Load Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(tidyverse)\nlibrary(stargazer)\nlibrary(estimatr)\nlibrary(dplyr)\nlibrary(plm)\nlibrary(lmtest)\nlibrary(car)\nlibrary(sandwich)\nlibrary(formatR)\n```\n:::\n\n\n#### Read in the Data[^1]\n\n[^1]: Here we use data from a 1995 paper studying housing prices during\n    the various stages of incinerator siting operations [@kiel1995].\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile_path <- here(\"posts\",\"correlation-vs-causation\",\"data\", \"KM_EDS241.csv\")\nraw_dat <- read_csv(file_path) |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 321\nColumns: 7\n$ year    <dbl> 1978, 1978, 1978, 1978, 1978, 1978, 1978, 1978, 1978, 1978, 19…\n$ age     <dbl> 48, 83, 58, 11, 48, 78, 22, 78, 42, 41, 78, 38, 18, 32, 18, 58…\n$ rooms   <dbl> 7, 6, 6, 5, 5, 6, 6, 6, 8, 5, 6, 5, 6, 6, 6, 7, 6, 5, 4, 5, 4,…\n$ area    <dbl> 1660, 2612, 1144, 1136, 1868, 1780, 1700, 1556, 1642, 1443, 14…\n$ land    <dbl> 4578, 8370, 5000, 10000, 10000, 9500, 10878, 3870, 7000, 7950,…\n$ nearinc <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1,…\n$ rprice  <dbl> 60000, 40000, 34000, 63900, 44000, 46000, 56000, 38500, 60500,…\n```\n:::\n\n```{.r .cell-code}\nclean_dat <- raw_dat |> \n  mutate(nearinc = as.factor(nearinc)) |> \n  mutate(known_nearinc = ifelse(nearinc==1 & year==1981,1,0)) |>  # since in 1978, the incinerator location wasn't well known\n  mutate(known_nearinc = as.factor(known_nearinc))\n```\n:::\n\n\n#### A Quick Data Exploration\n\nLooking at the housing data plotted into boxplot distributions, below,\nwe see that houses perceived as sited close to an incinerator (dots on\nthe right hand side) appear to have lower housing prices on average than\nthose houses not perceived as sited close to an incinerator (dots on the\nleft hand side). Is this because the housing locations perceived as\nclose to the incinerator are *simply* correlated with lower housing\nvalues for reasons other than incinerator proximity? Could this be\nbecause the incinerator is sited on less expensive land, with less\nexpensive homes? Or, is this because close incinerator proximity\n*causes* lower housing values? Perhaps, because people do not want to\nbuy homes in areas with worse air quality?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = clean_dat, mapping = aes(x = known_nearinc, y = rprice)) +\n  geom_boxplot(alpha = 0.5) +\n  xlab(\"Percieved as Close to Incinerator\") +\n  ylab(\"Inflation-Adjusted House Selling Price\") +\n  ggtitle(\"House Selling Prices and Incinerator Proximity\") +\n  scale_x_discrete(labels = c(\"No\", \"Yes\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n#### Finding Causation: Linear Regression with Difference In Differences Control Group Analysis\n\nTo help tease this out, we can use futher analysis that assumes that\nhousing values would change at the same rate over time (from 1978 to\n1981) if no incinerators ended up being built (this is called the\nparallel trends assumption) and look at the difference in differences\nbetween the effect of time on the 'treated' (houses with incinerators\nnearby) housing values vs the effect of time on the treated if the\ntreated were assumed to have the same rate of change in housing values\nas the control (houses without incinerators nearby). This approach also\neffectively controls for any time-variant omitted variables (like if\nsomething else such as a policy change influences housing prices across\nthe board). We also control for other time invariant variables (such as\nhouse size) that we have in our dataset that would otherwise create\nbias.\n\nThe `known_nearinc` variable effectively creates an indicator of 1 for\nthe house values in 1981 with incinerators known to be nearby (our\ntreatment group) and our control group is any other house value (since\nin 1978, it was not common knowledge that houses would be near an\nincinerator). Note that we still control for the `nearinc` variable\n(which represents houses that end up being near incinerators, whether\nthis was known or not), since this variable may represent a proxy for\nother factors like \"lower land values\" or other missing variables that\ncould influence housing prices that are also associated with choosing\nwhere to site an incinerator. According to the parallel trends\nassumption, the treatment group and control group should only have the\nsame slope *if there is no incinerator housing price effect*. If there\nis a difference in slope, this difference is the effect of treatment\n(i.e. at cause of the incinerator proximity). So, if the coefficient on\nthe `known_nearinc` is statistically significantly different from 0\n(since a non-zero value creates different slopes), we can definitively\nsay that perceived close proximity to a incinerator causes a decrease in\nhousing value.\n\nHere, we test whether or not the coefficient on the `known_nearinc`\nvariable is statistically significantly different from 0 and therefore\nwhether or not the closer incinerator proximity causes a decrease to\nhousing value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# linear regression also controlling for house and lot characteristics in addition to year using heteroskedastic robust SE\nlm_mod_all <- lm(formula = rprice ~ known_nearinc + nearinc + as.factor(year) + age + rooms + area + land, data = clean_dat)\nse_lmmod_all <- starprep(lm_mod_all, stat = c(\"std.error\"), se_type = \"HC2\", alpha = 0.05)\nstargazer(lm_mod_all, se = se_lmmod_all, type=\"text\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n===============================================\n                        Dependent variable:    \n                    ---------------------------\n                              rprice           \n-----------------------------------------------\nknown_nearinc1             -13,320.150**       \n                            (6,785.662)        \n                                               \nnearinc1                     3,514.141         \n                            (7,149.521)        \n                                               \nas.factor(year)1981        13,093.930***       \n                            (2,795.311)        \n                                               \nage                         -266.338***        \n                             (50.716)          \n                                               \nrooms                      6,969.002***        \n                            (1,542.265)        \n                                               \narea                         23.782***         \n                              (3.901)          \n                                               \nland                           0.127           \n                              (0.137)          \n                                               \nConstant                    -17,688.850        \n                           (11,070.580)        \n                                               \n-----------------------------------------------\nObservations                    321            \nR2                             0.612           \nAdjusted R2                    0.603           \nResidual Std. Error    20,857.870 (df = 313)   \nF Statistic           70.541*** (df = 7; 313)  \n===============================================\nNote:               *p<0.1; **p<0.05; ***p<0.01\n```\n:::\n:::\n\n\n## Final Thoughts on Incinerator Construction in North Andover\n\nThe key assumption underlying the causal interpretation of the\ndifference in estimator is the parallel trends assumption. In other\nwords, we must assume that the effect of time (1981 vs 1978) on\ninflation-adjusted house selling values should be the same in the\ntreatment (near incinerators) and control (not near incinerators) if\nthere were no incinerators at play here. In other words, if there is no\nomitted variables bias for time variant variables (the construction of\nan incinerator). There may be, however, other missing time variant\nvariables at play that may be correlated with incinerator proximity and\ncorrelated with housing values, such as the construction of a new\nschool. If this were the case, we could not definitively claim the\neffect of close proximity to an incinerator. However, barring other\nomitted time variant variables bias, this analysis shows that close\nproximity to incinerators does cause a decrease in housing value.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}