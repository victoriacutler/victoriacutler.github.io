{
  "hash": "c69f9a3933ca3e3f20b61dae5e02c277",
  "result": {
    "markdown": "---\ntitle: \"Correlation vs Causation: Air Quality and Housing Prices\"\ndescription: \"Teasing out causation from correlation using difference-in-differences analysis.\"\nauthor:\n  - name: Victoria Cutler\n    url: https://victoriacutler.github.io # can also add orchid id under here\n    affiliation: Master of Environmental Data Science at The Bren School (UCSB) \n    affiliation-url: https://ucsb-meds.github.io\ndate: 2023-07-27\ncategories: [R, LINEAR REGRESSION, CAUSATION, EQUITY]\ncitation:\n  url: https://victoriacutler.github.io/posts/correlation-vs-causation/\nbibliography: references.bib\nformat:\n  html:\n    code-fold: false\n    code-summary: \"code dropdown\"\nimage: \"correlation-vs-causation.jpeg\"\ndraft: true # \"true\" will mean this is a draft post so it wont show up on my site\neditor: \n  markdown: \n    wrap: 72\n---\n\n\n## How Can We Differentiate Between Correlation vs Causation?\n\nCorrelation can easily be confused with causation. Sometimes it's not so\nobvious whether X causes Y, or if X and Y are just correlated and simply\ntied together by a different actor, Z.\n\nFor example: it's plausable that people often get ice cream on days that\nthey also end up getting sunburned. Would this mean that ice cream\ncauses skin to burn? We know logically that people may get ice cream\nmore on warm sunny days, and it's these warm sunny days that cause the\nsunburns, not the ice cream. However, other problems are more nuanced an\ncomplex, and the answer may not be so obvious. How do we discern\ncausation from correlation, then?\n\n**The TLDR: we can use mathematics!** Here, I use\ndifference-in-differences analysis to determine whether or not proximity\nto an incinerator (a proxy for increased air pollution) causes a\ndecrease in housing value. A key assumption we need validated in order\nto perform this analysis is called the parallel trends assumption.\n\nFor this assumption to hold water, we need to be fairly certain that if\nwe had withheld treatment (i.e. if a nearby incinerator were never\ninstalled) the price of houses in the 'treated' group (i.e. houses that\nactually did end up nearby an incinerator) would have followed the same\npricing trend as the 'control' group (i.e. houses that did end up far\naway from an incinerator). By controlling for other time invariant\nvariables such as number of rooms, house size, and other attributes, I\nconsider this assumption and analyses valid.\n\n## The Code\n\n### Load Libraries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(tidyverse)\nlibrary(stargazer)\nlibrary(estimatr)\nlibrary(dplyr)\nlibrary(plm)\nlibrary(lmtest)\nlibrary(car)\nlibrary(sandwich)\nlibrary(formatR)\n```\n:::\n\n\n### Read in the Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile_path <- here(\"posts\",\"correlation-vs-causation\",\"data\", \"KM_EDS241.csv\")\nraw_dat <- read_csv(file_path) |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 321\nColumns: 7\n$ year    <dbl> 1978, 1978, 1978, 1978, 1978, 1978, 1978, 1978, 1978, 1978, 19…\n$ age     <dbl> 48, 83, 58, 11, 48, 78, 22, 78, 42, 41, 78, 38, 18, 32, 18, 58…\n$ rooms   <dbl> 7, 6, 6, 5, 5, 6, 6, 6, 8, 5, 6, 5, 6, 6, 6, 7, 6, 5, 4, 5, 4,…\n$ area    <dbl> 1660, 2612, 1144, 1136, 1868, 1780, 1700, 1556, 1642, 1443, 14…\n$ land    <dbl> 4578, 8370, 5000, 10000, 10000, 9500, 10878, 3870, 7000, 7950,…\n$ nearinc <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1,…\n$ rprice  <dbl> 60000, 40000, 34000, 63900, 44000, 46000, 56000, 38500, 60500,…\n```\n:::\n\n```{.r .cell-code}\nclean_dat <- raw_dat |> \n  mutate(nearinc = as.factor(nearinc)) |> \n  mutate(known_nearinc = ifelse(nearinc==1 & year==1981,1,0)) |>  # since in 1978, the incinerator location wasn't well known\n  mutate(known_nearinc = as.factor(known_nearinc))\n```\n:::\n\n\n### A Quick Data Exploration\n\nLooking at the housing data plotted into boxplot distributions, below,\nwe see that houses known to be sited near an incinerator (dots on the\nright hand side) appear to have lower housing prices on average than\nthose houses not known to be sited near an incinerator (dots on the left\nhand side). Is this because the incinerator location is correlated with\nlower housing values? (Perhaps the incinerator is sited on less\nexpensive land, with less expensive homes.) Or, is this because close\nincinerator proximity *causes* lower housing values? (Perhaps because\npeople do not want to buy homes in areas with worse air quality.)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = clean_dat, mapping = aes(x = known_nearinc, y = rprice)) +\n  geom_boxplot(alpha = 0.5) +\n  xlab(\"Known to be Near an Incinerator\") +\n  ylab(\"Inflation-Adjusted House Selling Price\") +\n  ggtitle(\"House Selling Prices and Incinerator Proximity\") +\n  scale_x_discrete(labels = c(\"No\", \"Yes\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Finding Causation: Linear Regression with Difference In Differences Analysis\n\nTo help tease this out, we can use futher analysis that assumes that\nhousing values would change at the same rate over time (from 1978 to\n1981) if no incinerators ended up being built (this is called the\nparallel trends assumption) and look at the difference in differences\nbetween the effect of time on the 'treated' (houses with incinerators\nnearby) housing values vs the effect of time on the treated if the\ntreated were assumed to have the same rate of change in housing values\nas the control (houses without incinerators nearby). This approach also\neffectively controls for any time-invariant omitted variables (like if\nsomething else like a policy change influencing housing prices across\nthe board). We also control for other time variant variables that we\nhave in our dataset that would otherwise create bias.\n\nThe `known_nearinc` variable effectively creates an indicator of 1 for\nthe houses in 1981 with incinerators known to be nearby (our treatment\ngroup) and our control group is any other house (since, in 1978, it was\nnot common knowledge that houses would be near an incinerator). And\nsince we are controlling for the incinerator (with the `nearinc`\nvariable), according to the parallel trends assumption, the treatment\ngroup and control group should have the same slope if there is no\nincinerator housing price effect. In other words, the coefficient on the\n`known_nearinc` should not be statistically significantly different from\n0 (as a non-zero value would create different slopes).\n\nTest the hypothesis that the coefficients on the house and lot\ncharacteristics are all jointly equal to 0.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# linear regression also controlling for house and lot characteristics in addition to year using heteroskedastic robust SE\nlm_mod_all <- lm(formula = rprice ~ known_nearinc + nearinc + as.factor(year) + age + rooms + area + land, data = clean_dat)\nse_lmmod_all <- starprep(lm_mod_all, stat = c(\"std.error\"), se_type = \"HC2\", alpha = 0.05)\nstargazer(lm_mod_all, se = se_lmmod_all, type=\"text\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n===============================================\n                        Dependent variable:    \n                    ---------------------------\n                              rprice           \n-----------------------------------------------\nknown_nearinc1             -13,320.150**       \n                            (6,785.662)        \n                                               \nnearinc1                     3,514.141         \n                            (7,149.521)        \n                                               \nas.factor(year)1981        13,093.930***       \n                            (2,795.311)        \n                                               \nage                         -266.338***        \n                             (50.716)          \n                                               \nrooms                      6,969.002***        \n                            (1,542.265)        \n                                               \narea                         23.782***         \n                              (3.901)          \n                                               \nland                           0.127           \n                              (0.137)          \n                                               \nConstant                    -17,688.850        \n                           (11,070.580)        \n                                               \n-----------------------------------------------\nObservations                    321            \nR2                             0.612           \nAdjusted R2                    0.603           \nResidual Std. Error    20,857.870 (df = 313)   \nF Statistic           70.541*** (df = 7; 313)  \n===============================================\nNote:               *p<0.1; **p<0.05; ***p<0.01\n```\n:::\n\n```{.r .cell-code}\n# isolating the coefficient on the near an incinerator indicator\nnearinc_coef_cntrlall <- as.numeric(lm_mod_all$coefficients[2])\n\n# f-test to test the hypothesis that the coefficients for all of these additional variables are statistically significantly different from 0\nF_test <- linearHypothesis(lm_mod_all, c(\"age = 0\", \"rooms = 0\", \"area = 0\", \"land = 0\"), \n                           vcov = vcovHC(lm_mod_all, type = \"HC2\"))\nF_test\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear hypothesis test\n\nHypothesis:\nage = 0\nrooms = 0\narea = 0\nland = 0\n\nModel 1: restricted model\nModel 2: rprice ~ known_nearinc + nearinc + as.factor(year) + age + rooms + \n    area + land\n\nNote: Coefficient covariance matrix supplied.\n\n  Res.Df Df      F    Pr(>F)    \n1    317                        \n2    313  4 34.512 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\nAs seen above as an output of the regression, when we also control for\nhouse and lot characteristics, we can see that the causal effect from\nclose proximity to an incinerator on inflation-adjusted housing selling\nprice is much smaller (\", round(nearinc_coef_cntrlall, 2),\") and is no\nlonger statistically significant. This means that the previous models\nwere biased due to omitted variables that were correlated with the other\ncovariates and also the inflation-adjusted housing selling price. We now\nsee that many other house and lot characteristics have a statistically\nsignificant causal effect on inflation-adjusted house selling value and\nsince those variables were correlated with houses being near an\nincinerator, these relationships were previously 'hidden' in the\nincinerator term. The F-test results, as shown above, adjusted for\nheteroskedastic error also show us that all of the housing and lot\ncharacteristics have causal effects statistically significant from 0,\nwith a p value \\> 0.0005\n\n## Final Thoughts on incinerator construction in North Andover.\n\nThe key assumption underlying the causal interpretation of the DD\nestimator is the parallel trends assumption. In other words, we assume\nthat the effect of time (1981 vs 1978) on inflation-adjusted house\nselling values should be the same in the treatment (near incinerators)\nand control (not near incinerators) if there were no incinerators at\nplay here. In other words, there is no omitted variables bias for time\nvariant variables. We found this to be untrue since there were clearly\nhousehold attributes (as seen above) that we omitted that led to bias.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}